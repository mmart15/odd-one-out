<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Odd One Out â€” Daily</title>
  <style>
    :root{
      --bg:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;
      --tile:#f8fafc;
      --tileHover:#eef2f7;

      --accent:#ef4444;
      --accentSoft:#fee2e2;

      --sel:#3b82f6;
      --selSoft:#dbeafe;

      --ok:#22c55e;
      --okSoft:#dcfce7;

      --bad:#ef4444;
      --badSoft:#fee2e2;

      --hint:#a855f7;
      --hintSoft:#f3e8ff;
    }

    *{ box-sizing:border-box; }

    /* Prevent horizontal overflow + iOS autosizing weirdness */
    html, body { overflow-x:hidden; }
    html { -webkit-text-size-adjust:100%; text-size-adjust:100%; }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      color:var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 500px at 12% 10%, var(--accentSoft), transparent 55%),
        radial-gradient(800px 480px at 92% 0%, var(--selSoft), transparent 55%),
        radial-gradient(900px 600px at 80% 95%, var(--okSoft), transparent 55%),
        var(--bg);
    }

    .wrap{ width:min(900px, 96vw); }

    .panel{
      background: rgba(255,255,255,.9);
      border:1px solid var(--border);
      border-radius:18px;
      padding:14px;
      box-shadow: 0 12px 35px rgba(15,23,42,.10);
      backdrop-filter: blur(6px);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin:0 0 10px 0;
    }

    .title{
      font-weight:900;
      letter-spacing:.2px;
      font-size:18px;
      margin:0;
      line-height:1.1;
    }
    .title .out{ color:var(--accent); }

    .meta{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      color:var(--muted);
      font-size:12px;
    }

    .chip{
      border:1px solid var(--border);
      padding:6px 10px;
      border-radius:999px;
      background:#fff;
      display:flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }

    .chip .dot{
      width:9px; height:9px; border-radius:999px;
      background: var(--hint);
      box-shadow: 0 0 0 4px rgba(168,85,247,.14);
    }

    .bar{
      height:10px;
      border-radius:999px;
      background:#fff;
      border:1px solid var(--border);
      overflow:hidden;
      width: 180px;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--sel), var(--accent));
      border-radius:999px;
      transition: width .25s ease;
    }

    .game{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background:#fff;
    }

    .topline{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    .roundLeft{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .roundLabel{
      font-size:14px;
      font-weight:900;
      display:flex;
      align-items:baseline;
      gap:10px;
    }

    .instruction{
      color:var(--muted);
      font-size:12px;
      font-weight:800;
      text-align:right;
      flex:1;
      min-width:180px;
    }

    /* Timer ring */
    .timerWrap{
      width:34px;
      height:34px;
      border-radius:999px;
      display:grid;
      place-items:center;
    }
    .timerSvg{
      width:34px;
      height:34px;
      display:block;
    }
    .timerBg{
      stroke: rgba(100,116,139,.25);
      stroke-width:4.5;
      fill:none;
    }
    .timerFg{
      stroke: var(--sel);
      stroke-width:4.5;
      fill:none;
      stroke-linecap:round;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
      transition: stroke .15s ease;
    }
    .timerFg.warn{ stroke: var(--accent); }
    .timerFg.ok{ stroke: var(--sel); }

    .grid{
      display:grid;
      gap:10px;
      width:100%;
    }
    .grid > * { min-width:0; }

    button.tile{
      appearance:none;
      border:1px solid var(--border);
      background: var(--tile);
      color: var(--ink);
      border-radius:14px;
      padding:14px 10px;
      cursor:pointer;
      user-select:none;
      font-weight:900;
      text-transform: uppercase;
      letter-spacing:.5px;
      transition: transform .06s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    button.tile:hover{ background: var(--tileHover); }
    button.tile:active{ transform: translateY(1px); }
    button.tile[disabled]{ cursor:not-allowed; opacity:.95; }

    button.tile.selected{
      background:#fff;
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 0 0 3px rgba(59,130,246,.18);
    }

    button.tile.correct{
      background: linear-gradient(180deg, var(--ok), #16a34a);
      color:#fff;
      border-color: rgba(34,197,94,.9);
      box-shadow: 0 0 0 3px rgba(34,197,94,.15);
    }
    button.tile.wrong{
      background: linear-gradient(180deg, var(--bad), #dc2626);
      color:#fff;
      border-color: rgba(239,68,68,.9);
      box-shadow: 0 0 0 3px rgba(239,68,68,.12);
    }

    .controls{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .pickcount{
      font-size:12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pickcount .badge{
      border:1px solid var(--border);
      background:#fff;
      padding:4px 8px;
      border-radius:999px;
      font-weight:800;
      color: var(--ink);
    }

    .btnRow{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

    .btn{
      appearance:none;
      border:1px solid var(--border);
      background:#fff;
      color: var(--ink);
      padding:9px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.2px;
      transition: background .15s ease, transform .06s ease, border-color .15s ease;
    }
    .btn:hover{ background:#f8fafc; }
    .btn:active{ transform: translateY(1px); }
    .btn[disabled]{ opacity:.55; cursor:not-allowed; }

    .btn.primary{
      border-color: rgba(59,130,246,.45);
      background: linear-gradient(180deg, rgba(59,130,246,.12), rgba(59,130,246,.06));
    }
    .btn.primary:hover{ background: rgba(59,130,246,.12); }

    .btn.ghost{
      border-color: rgba(239,68,68,.35);
      background: linear-gradient(180deg, rgba(239,68,68,.10), rgba(239,68,68,.05));
    }
    .btn.ghost:hover{ background: rgba(239,68,68,.10); }

    .rule{
      margin-top:10px;
      padding-top:10px;
      border-top:1px dashed var(--border);
      color:var(--muted);
      font-size:13px;
      font-weight:800;
      display:none;
    }
    .rule strong{ color:var(--ink); }

    .footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
      color: var(--muted);
      font-size:12px;
      min-height:18px;
    }

    /* End Screen (Daily Complete) */
    .endScreen{
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px 14px;
      background:#fff;
      display:none;
      text-align:center;
    }
    .endTitle{
      margin:0;
      font-size:18px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .endSub{
      margin:8px 0 0 0;
      color:var(--muted);
      font-size:13px;
      font-weight:800;
    }
    .endScore{
      margin:10px 0 0 0;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color:var(--muted);
      font-size:12px;
      font-weight:800;
    }
    .endScore .pill{
      border:1px solid var(--border);
      background:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      color: var(--ink);
    }
    .endActions{
      margin-top:12px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .endMiniShare{
      margin-top:12px;
      padding:10px;
      border:1px solid var(--border);
      border-radius:14px;
      background:#fff;
      text-align:left;
    }
    .endMiniShare pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:12px;
      color: var(--ink);
    }

    /* Modals */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(15,23,42,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .overlay.show{ display:flex; }

    .modal{
      width:min(520px, 96vw);
      background: rgba(255,255,255,.95);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: 0 25px 80px rgba(15,23,42,.25);
      padding:14px;
      backdrop-filter: blur(8px);
    }

    .modalTop{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
    }

    .modalTitle{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:.2px;
    }

    .xbtn{
      border:1px solid var(--border);
      background:#fff;
      border-radius:12px;
      width:38px;
      height:38px;
      cursor:pointer;
      font-weight:900;
      color: var(--muted);
    }
    .xbtn:hover{ background:#f8fafc; }

    .scoreLine{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color: var(--muted);
      font-size:12px;
    }
    .scorePill{
      border:1px solid var(--border);
      background:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      color: var(--ink);
    }
    .tomorrow{
      margin-top:10px;
      font-size:13px;
      color: var(--ink);
      font-weight:800;
    }
    .tomorrow b{ color: var(--accent); }

    .modalActions{
      margin-top:12px;
      display:flex;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }

    .miniShare{
      margin-top:10px;
      padding:10px;
      border:1px solid var(--border);
      border-radius:14px;
      background:#fff;
    }
    .miniShare pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:12px;
      color: var(--ink);
    }

    /* Round Result Popup */
    .modal.small{ width:min(420px, 96vw); }
    .resultBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      font-weight:900;
      margin-top:10px;
    }
    .resultBadge.good{
      border-color: rgba(34,197,94,.45);
      box-shadow: 0 0 0 3px rgba(34,197,94,.12);
    }
    .resultBadge.bad{
      border-color: rgba(239,68,68,.45);
      box-shadow: 0 0 0 3px rgba(239,68,68,.12);
    }

    /* Mobile sizing */
    @media (max-width: 480px) {
      .wrap { width: 100vw; padding: 6px; }
      .panel { padding: 10px; border-radius: 14px; }
      .game { padding: 8px; }

      /* Fix tiny overhang/overflow on mobile grids */
      .grid { grid-template-columns: repeat(auto-fit, minmax(0, 1fr)); }

      button.tile { padding: 10px 6px; font-size: 13px; }

      .title { font-size: 16px; }
      .roundLabel { font-size: 13px; }
      .instruction { font-size: 12px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="panel">
      <header>
        <h1 class="title">Odd One <span class="out">Out</span></h1>
        <div class="meta">
          <div class="chip"><span class="dot"></span><span id="dayText">Day</span></div>
          <div class="bar"><div id="progFill"></div></div>
        </div>
      </header>

      <!-- Game Screen -->
      <div class="game" id="gameScreen">
        <div class="topline">
          <div class="roundLeft">
            <div class="roundLabel"><span id="roundTitle">Round 1</span></div>

            <!-- Timer Ring -->
            <div class="timerWrap" aria-label="Round timer">
              <svg class="timerSvg" viewBox="0 0 36 36" aria-hidden="true">
                <circle class="timerBg" cx="18" cy="18" r="14"></circle>
                <circle class="timerFg ok" id="timerFg" cx="18" cy="18" r="14"></circle>
              </svg>
            </div>
          </div>

          <div class="instruction" id="instrText"><b>Find the odd word and lock it in.</b></div>
        </div>

        <div class="grid" id="grid"></div>

        <div class="controls">
          <div class="pickcount">
            <span class="badge" id="pickBadge">0/1</span>
            <span id="pickHint">Selected</span>
          </div>
          <div class="btnRow">
            <button class="btn primary" id="lockBtn" disabled>Lock in</button>
            <button class="btn" id="nextBtn" disabled>Next</button>
          </div>
        </div>

        <div class="rule" id="ruleBox"></div>
      </div>

      <!-- Daily Complete Screen -->
      <div class="endScreen" id="endScreen">
        <h2 class="endTitle">Thanks for playing!</h2>
        <p class="endSub">Come back tomorrow for a new puzzle.</p>

        <div class="endScore">
          <span class="pill" id="endScorePill">Score: 0/3</span>
          <span id="endScoreNote">â€”</span>
        </div>

        <div class="endActions">
          <button class="btn ghost" id="endCopyBtn">Copy Share</button>
        </div>

        <div class="endMiniShare">
          <pre id="endMiniShareText"></pre>
        </div>
      </div>

      <div class="footer">
        <div id="msg"></div>
        <div class="btnRow">
          <button class="btn ghost" id="copyBtn">Copy Share</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Round Result Popup -->
  <div class="overlay" id="resultOverlay" role="dialog" aria-modal="true" aria-label="Round result">
    <div class="modal small">
      <div class="modalTop">
        <div>
          <h2 class="modalTitle" id="resultTitle">Result</h2>
          <div class="resultBadge" id="resultBadge">â€”</div>
        </div>
        <button class="xbtn" id="closeResult" aria-label="Close">âœ•</button>
      </div>

      <div class="modalActions">
        <button class="btn primary" id="resultContinue">Continue</button>
      </div>
    </div>
  </div>

  <!-- Completion Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Puzzle complete">
    <div class="modal">
      <div class="modalTop">
        <div>
          <h2 class="modalTitle">All done ðŸŽ‰</h2>
          <div class="scoreLine">
            <span class="scorePill" id="scorePill">Score: 0/3</span>
            <span id="scoreNote">â€”</span>
          </div>
        </div>
        <button class="xbtn" id="closeModal" aria-label="Close">âœ•</button>
      </div>

      <div class="tomorrow">Come back <b>tomorrow</b> for a new puzzle.</div>

      <div class="miniShare">
        <pre id="miniShareText"></pre>
      </div>

      <div class="modalActions">
        <button class="btn ghost" id="modalCopy">Copy Share</button>
        <button class="btn primary" id="modalOk">OK</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // Round timers (seconds): 10 / 20 / 30
  const ROUND_SECONDS = [10, 20, 30];

  // --- Daily puzzles (progressively harder, but fair) ---
  // Round 1: very obvious category
  // Round 2: pattern-based (not too brutal)
  // Round 3: trickier but guessable with thought
  
  const  DAYS = [
  {
    id: 1,
    rounds: [
      {
        // Round 1 (4 words â€“ easy)
        options: ["DOG", "CAT", "HORSE", "CAR"],
        oddIndex: 3,
        rule: "Three are animals."
      },
      {
        // Round 2 (6 words â€“ medium)
        options: ["APPLE", "PEAR", "PLUM", "PEACH", "GRAPE", "CARROT"],
        oddIndex: 5,
        rule: "Five are fruits."
      },
      {
        // Round 3 (8 words â€“ harder but fair)
        options: ["KNIFE", "KNEE", "KNOT", "KNEW", "GNOME", "WRITE", "WRONG", "ROBOT"],
        oddIndex: 7,
        rule: "Most begin with a silent letter."
      }
    ]
  }
];


  // --- Day selection ---
  const start = new Date(Date.UTC(2026, 0, 1));
  const now = new Date();
  const utcMidnight = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));
  const dayNumber = Math.floor((utcMidnight - start) / 86400000) + 1;
  const dayPuzzle = DAYS[(dayNumber - 1) % DAYS.length];
  const storageKey = `ooo_daily_${dayNumber}`;

  // --- Elements ---
  const dayText = document.getElementById("dayText");
  const progFill = document.getElementById("progFill");
  const roundTitle = document.getElementById("roundTitle");
  const instrText = document.getElementById("instrText");
  const gridEl = document.getElementById("grid");
  const pickBadge = document.getElementById("pickBadge");
  const lockBtn = document.getElementById("lockBtn");
  const nextBtn = document.getElementById("nextBtn");
  const ruleBox = document.getElementById("ruleBox");
  const msgEl = document.getElementById("msg");
  const copyBtn = document.getElementById("copyBtn");

  const gameScreen = document.getElementById("gameScreen");
  const endScreen = document.getElementById("endScreen");
  const endScorePill = document.getElementById("endScorePill");
  const endScoreNote = document.getElementById("endScoreNote");
  const endMiniShareText = document.getElementById("endMiniShareText");
  const endCopyBtn = document.getElementById("endCopyBtn");

  const overlay = document.getElementById("overlay");
  const closeModal = document.getElementById("closeModal");
  const modalOk = document.getElementById("modalOk");
  const modalCopy = document.getElementById("modalCopy");
  const scorePill = document.getElementById("scorePill");
  const scoreNote = document.getElementById("scoreNote");
  const miniShareText = document.getElementById("miniShareText");

  const resultOverlay = document.getElementById("resultOverlay");
  const closeResult = document.getElementById("closeResult");
  const resultContinue = document.getElementById("resultContinue");
  const resultTitle = document.getElementById("resultTitle");
  const resultBadge = document.getElementById("resultBadge");

  const timerFg = document.getElementById("timerFg");

  dayText.textContent = `Day #${dayNumber}`;

  // --- State ---
  // timerStartedAt: [ms or null] per round
  let state = JSON.parse(localStorage.getItem(storageKey)) || {
    roundIndex: 0,
    selected: [null,null,null],
    locked: [false,false,false],
    results: [null,null,null],
    shownCompleteModal: false,
    timerStartedAt: [null,null,null]
  };

  function save(){ localStorage.setItem(storageKey, JSON.stringify(state)); }

  // --- Helpers ---
  function colsFor(n){ return n <= 4 ? 2 : 4; }
  function emoji(r){ return r===true ? "ðŸŸ©" : "ðŸŸ¥"; }
  function score(){ return state.results.filter(v => v === true).length; }
  function scoreFlavor(s){
    return s === 3 ? "Perfect!" :
           s === 2 ? "Nice work." :
           s === 1 ? "You got one." :
           "Tough one today.";
  }

  function buildShare(){
    return `Odd One Out #${dayNumber}
${emoji(state.results[0])} Round 1
${emoji(state.results[1])} Round 2
${emoji(state.results[2])} Round 3`;
  }

  // --- Timer ring logic ---
  let tickHandle = null;

  function ringSetup() {
    // 2Ï€r for r=14
    const C = 2 * Math.PI * 14;
    timerFg.style.strokeDasharray = `${C}`;
    timerFg.style.strokeDashoffset = `${0}`;
  }

  function stopTick(){
    if(tickHandle){ clearInterval(tickHandle); tickHandle = null; }
  }

  function roundTotalMs(ri){ return ROUND_SECONDS[ri] * 1000; }

  function getRemainingMs(ri){
    const startAt = state.timerStartedAt[ri];
    const total = roundTotalMs(ri);
    if(!startAt) return total;
    const elapsed = Date.now() - startAt;
    return Math.max(0, total - elapsed);
  }

  function setRingFromRemaining(ri){
    const total = roundTotalMs(ri);
    const rem = getRemainingMs(ri);
    const frac = total === 0 ? 0 : (rem / total);

    const C = 2 * Math.PI * 14;
    timerFg.style.strokeDasharray = `${C}`;
    timerFg.style.strokeDashoffset = `${C * (1 - frac)}`;

    // Color shifts near the end
    if(frac <= 0.25) {
      timerFg.classList.remove("ok");
      timerFg.classList.add("warn");
    } else {
      timerFg.classList.remove("warn");
      timerFg.classList.add("ok");
    }
  }

  function ensureTimerRunning(){
    const ri = state.roundIndex;
    if(state.locked[ri]) { stopTick(); return; }

    // Start timer at first render of an unlocked round
    if(!state.timerStartedAt[ri]) {
      state.timerStartedAt[ri] = Date.now();
      save();
    }

    stopTick();
    tickHandle = setInterval(() => {
      if(resultOverlay.classList.contains("show") || overlay.classList.contains("show")) {
        // Donâ€™t tick/auto-submit while a modal is up
        return;
      }
      const rem = getRemainingMs(ri);
      setRingFromRemaining(ri);
      if(rem <= 0){
        stopTick();
        timeUpAutoLock();
      }
    }, 100);
  }

  function timeUpAutoLock(){
    // If time runs out: lock round as incorrect (even if they selected something)
    const ri = state.roundIndex;
    if(state.locked[ri]) return;

    state.results[ri] = false;
    state.locked[ri] = true;
    save();
    render();

    // Show popup
    resultTitle.textContent = `Round ${ri + 1}`;
    resultBadge.className = "resultBadge bad";
    resultBadge.textContent = "â±ï¸ Timeâ€™s up";
    resultOverlay.classList.add("show");
  }

  // --- Modals ---
  function showCompletionModal(){
    const s = score();
    scorePill.textContent = `Score: ${s}/3`;
    scoreNote.textContent = scoreFlavor(s);
    miniShareText.textContent = buildShare();
    overlay.classList.add("show");
    state.shownCompleteModal = true;
    save();
  }
  function hideCompletionModal(){ overlay.classList.remove("show"); }

  function showResultModal(isCorrect){
    resultTitle.textContent = `Round ${state.roundIndex + 1}`;
    resultBadge.className = "resultBadge " + (isCorrect ? "good" : "bad");
    resultBadge.textContent = isCorrect ? "âœ… Correct" : "âŒ Incorrect";
    resultOverlay.classList.add("show");
  }
  function hideResultModal(){ resultOverlay.classList.remove("show"); }

  // --- Rendering ---
  function renderEndScreen(){
    stopTick();
    gameScreen.style.display = "none";
    endScreen.style.display = "block";

    const s = score();
    endScorePill.textContent = `Score: ${s}/3`;
    endScoreNote.textContent = scoreFlavor(s);
    endMiniShareText.textContent = buildShare();

    msgEl.textContent = "You're done for today.";
    progFill.style.width = "100%";
  }

  function renderGameScreen(){
    const ri = state.roundIndex;
    const r = dayPuzzle.rounds[ri];
    const n = r.options.length;

    gameScreen.style.display = "block";
    endScreen.style.display = "none";

    roundTitle.textContent = `Round ${ri + 1}`;
    instrText.innerHTML = `<b>Find the odd word and lock it in.</b>`;
    progFill.style.width = `${(state.locked.filter(Boolean).length / 3) * 100}%`;

    // Grid columns (mobile overrides in CSS)
    gridEl.style.gridTemplateColumns = `repeat(${colsFor(n)}, 1fr)`;
    gridEl.innerHTML = "";

    r.options.forEach((w,i)=>{
      const b = document.createElement("button");
      b.className = "tile";
      b.textContent = w;
      b.disabled = state.locked[ri];

      if(!state.locked[ri] && state.selected[ri] === i) b.classList.add("selected");

      if(state.locked[ri]){
        if(i === state.selected[ri]) b.classList.add(i === r.oddIndex ? "correct" : "wrong");
        if(state.selected[ri] !== r.oddIndex && i === r.oddIndex) b.classList.add("correct");
      }

      b.onclick = () => {
        if(state.locked[ri]) return;
        state.selected[ri] = i;
        save();
        render();
      };

      gridEl.appendChild(b);
    });

    pickBadge.textContent = `${state.selected[ri] == null ? 0 : 1}/1`;
    lockBtn.disabled = state.locked[ri] || state.selected[ri] == null;
    nextBtn.disabled = !state.locked[ri] || ri === 2;

    if(state.locked[ri]){
      ruleBox.style.display = "block";
      ruleBox.innerHTML = `<strong>Rule:</strong> ${r.rule}`;
    } else {
      ruleBox.style.display = "none";
      ruleBox.innerHTML = "";
    }

    msgEl.textContent = "Choose the odd one out.";

    // Timer ring update
    ringSetup();
    setRingFromRemaining(ri);
    ensureTimerRunning();
  }

  function render(){
    if(state.locked.every(Boolean)){
      renderEndScreen();
      if(!state.shownCompleteModal) showCompletionModal();
      return;
    }
    renderGameScreen();
  }

  // --- Buttons ---
  lockBtn.onclick = () => {
    const ri = state.roundIndex;
    const r = dayPuzzle.rounds[ri];
    const s = state.selected[ri];
    if(s == null) return;

    const correct = (s === r.oddIndex);
    state.results[ri] = correct;
    state.locked[ri] = true;
    save();
    render();
    showResultModal(correct);
  };

  nextBtn.onclick = () => {
    if(state.roundIndex < 2){
      state.roundIndex++;
      save();
      render();
    }
  };

  async function doCopy(){
    const txt = buildShare();
    try{
      await navigator.clipboard.writeText(txt);
      msgEl.textContent = "Copied share text!";
    } catch {
      msgEl.textContent = "Clipboard blockedâ€”copy manually.";
    }
  }
  copyBtn.onclick = doCopy;
  endCopyBtn.onclick = doCopy;

  // Completion modal actions
  closeModal.onclick = hideCompletionModal;
  modalOk.onclick = hideCompletionModal;
  overlay.addEventListener("click", (e) => { if(e.target === overlay) hideCompletionModal(); });
  modalCopy.onclick = async () => {
    const txt = buildShare();
    try{ await navigator.clipboard.writeText(txt); scoreNote.textContent = "Copied!"; }
    catch { scoreNote.textContent = "Copy manually below."; }
  };

  // Result modal actions
  closeResult.onclick = () => { hideResultModal(); render(); };
  resultContinue.onclick = () => { hideResultModal(); render(); };
  resultOverlay.addEventListener("click", (e) => { if(e.target === resultOverlay) { hideResultModal(); render(); } });

  // ESC closes any open modal
  window.addEventListener("keydown", (e) => {
    if(e.key !== "Escape") return;
    hideResultModal();
    hideCompletionModal();
  });

  render();
})();
</script>
</body>
</html>
